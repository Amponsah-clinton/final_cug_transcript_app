{% extends "base.html" %}
{% block content %}
<!-- Animated Background -->
<div class="animated-bg"></div>

<div class="signup-wrapper py-5">
  <div class="d-flex justify-content-center">
    <form method="post" class="form shadow-lg" novalidate>
      {% csrf_token %}
      <p class="title">Sign Up</p>
      <p class="message text-center mb-3">Create your account to continue</p>

      <!-- Django messages -->
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}

      <!-- Non-field errors -->
      {% if form.non_field_errors %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <ul class="mb-0">
            {% for error in form.non_field_errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endif %}

      <label>
        {{ form.username }}
        <span>Username</span>
        {% if form.username.errors %}
          <div class="text-danger small">{{ form.username.errors|striptags }}</div>
        {% endif %}
      </label>

      <label>
        {{ form.email }}
        <span>Email</span>
        {% if form.email.errors %}
          <div class="text-danger small">{{ form.email.errors|striptags }}</div>
        {% endif %}
      </label>

      <label>
        {{ form.index_number }}
        <span>Index Number</span>
        {% if form.index_number.errors %}
          <div class="text-danger small">{{ form.index_number.errors|striptags }}</div>
        {% endif %}
      </label>

      <label>
        {{ form.phone }}
        <span>Phone</span>
        {% if form.phone.errors %}
          <div class="text-danger small">{{ form.phone.errors|striptags }}</div>
        {% endif %}
      </label>

      <label>
        {{ form.password1 }}
        <span>Password</span>
        <small class="form-text text-muted">
          Must be 8+ chars, 1 uppercase, 1 lowercase, 1 number, 1 special character
        </small>
        <div id="passwordFeedback" class="mt-1 small"></div>
      </label>

      <label>
        {{ form.password2 }}
        <span>Confirm Password</span>
        {% if form.password2.errors %}
          <div class="text-danger small">{{ form.password2.errors|striptags }}</div>
        {% endif %}
      </label>

      <button type="submit" class="submit fw-bold">Sign Up</button>
      <p class="signin mt-2">Already have an account? <a href="{% url 'login' %}">Login here</a></p>
    </form>
  </div>
</div>

<style>
/* ===== Animated Background ===== */
.animated-bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;
  background: linear-gradient(rgba(0, 0, 0, 0.45), rgba(0, 0, 0, 0.45)),
    url("https://res.cloudinary.com/dsypclqxk/image/upload/v1756722559/catholic-university-ghana-logo_onhrgj.jpg")
    no-repeat center center;
  background-size: contain;
  z-index: -1;
  animation: slowFloat 12s ease-in-out infinite;
}

@keyframes slowFloat {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-25px); }
}

/* ===== Sign-up Layout ===== */
.signup-wrapper {
  min-height: calc(100vh - 120px);
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  padding: 30px;
  z-index: 1;
  position: relative;
}

.form {
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-width: 380px;
  width: 100%;
  background-color: rgba(255, 255, 255, 0.95);
  padding: 30px 25px;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  position: relative;
}

.title {
  font-size: 26px;
  color: royalblue;
  font-weight: 600;
  letter-spacing: -1px;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.title::before, .title::after {
  position: absolute;
  content: "";
  height: 14px;
  width: 14px;
  border-radius: 50%;
  left: 30%;
  background-color: royalblue;
}

.title::before {
  width: 16px;
  height: 16px;
}

.title::after {
  width: 16px;
  height: 16px;
  animation: pulse 1s linear infinite;
}

.message,
.signin {
  color: rgba(88, 87, 87, 0.822);
  font-size: 14px;
}

.signin {
  text-align: center;
}

.signin a {
  color: royalblue;
}

.signin a:hover {
  text-decoration: underline royalblue;
}

.form label {
  position: relative;
}

.form label input {
  width: 100%;
  padding: 10px 10px 20px 10px;
  outline: 0;
  border: 1px solid rgba(105, 105, 105, 0.397);
  border-radius: 10px;
  font-size: 0.95rem;
  background: transparent;
}

.form label input::placeholder {
  color: transparent;
}

.form label input + span {
  position: absolute;
  left: 12px;
  top: 14px;
  color: grey;
  font-size: 0.9em;
  cursor: text;
  transition: 0.3s ease;
}

.form label input:placeholder-shown + span {
  top: 14px;
  font-size: 0.9em;
}

.form label input:focus + span,
.form label input:valid + span {
  top: 28px;
  font-size: 0.75em;
  font-weight: 600;
}

.form label input:valid + span {
  color: green;
}

.submit {
  border: none;
  outline: none;
  background-color: royalblue;
  padding: 10px;
  border-radius: 10px;
  color: #fff;
  font-size: 16px;
  transition: 0.3s ease;
}

.submit:hover {
  background-color: rgb(56, 90, 194);
}

@keyframes pulse {
  from { transform: scale(0.9); opacity: 1; }
  to { transform: scale(1.8); opacity: 0; }
}

@media (max-height: 700px) {
  .signup-wrapper {
    align-items: flex-start;
    padding-top: 30px;
    padding-bottom: 30px;
  }
}
</style>

<script>
setTimeout(() => {
  document.querySelectorAll('.alert').forEach(alert => {
    const bsAlert = new bootstrap.Alert(alert);
    bsAlert.close();
  });
}, 4000);

const passwordInput = document.getElementById("id_password1");
const feedback = document.getElementById("passwordFeedback");

if (passwordInput) {
  passwordInput.addEventListener("input", () => {
    const val = passwordInput.value;
    let messages = [];

    if (val.length >= 8) messages.push("✔ At least 8 characters"); else messages.push("✖ At least 8 characters");
    if (/[A-Z]/.test(val)) messages.push("✔ Uppercase letter"); else messages.push("✖ Uppercase letter");
    if (/[a-z]/.test(val)) messages.push("✔ Lowercase letter"); else messages.push("✖ Lowercase letter");
    if (/[0-9]/.test(val)) messages.push("✔ Number"); else messages.push("✖ Number");
    if (/[!@#$%^&*(),.?\":{}|<>]/.test(val)) messages.push("✔ Special character"); else messages.push("✖ Special character");

    feedback.innerHTML = messages.join("<br>");
  });
}
</script>
{% endblock %}
