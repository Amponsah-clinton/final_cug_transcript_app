{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-5">
  <div class="card shadow-lg border-0 rounded-4 p-4 mx-auto" style="max-width: 900px;">
  <h4 class="text-center mb-4 text-primary fw-bold">Edit {{ display_name }}</h4>

    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
      {% csrf_token %}
      <div class="row g-4">
        <div class="col-md-6">
          <h5 class="fw-semibold text-secondary mb-3 border-bottom pb-2">User Information</h5>
          {% for field in user_form %}
            <div class="mb-3">
              <label class="form-label fw-semibold">{{ field.label }}</label>
              {{ field }}
              {% if field.errors %}
                <div class="text-danger small mt-1">{{ field.errors|striptags }}</div>
              {% endif %}
            </div>
          {% endfor %}
        </div>

        <div class="col-md-6">
          <h5 class="fw-semibold text-secondary mb-3 border-bottom pb-2">Officer Details & Official Image</h5>
          {% for field in profile_form %}
            <div class="mb-3">
              <label class="form-label fw-semibold">{{ field.label }}</label>
              {{ field }}
              {% if field.errors %}
                <div class="text-danger small mt-1">{{ field.errors|striptags }}</div>
              {% endif %}
            </div>
          {% endfor %}

          <div class="alert alert-info mt-3 border-start border-primary border-4">
            <strong>Official signature</strong>: uploading a new signature will update the image used on transcripts.
            Uploaded signatures are stored in MEDIA and take precedence over the static images.
          </div>

          <div class="text-center mt-3">
            <p class="fw-semibold mb-2">Current Official Signature:</p>
            {% if profile and profile.signature %}
              <img src="{{ profile.signature.url }}" alt="{{ role|title }} signature" class="rounded shadow-sm border" style="max-width:180px; max-height:180px;" />
            {% else %}
              <img src="{% static 'images/' %}{{ role }}.png" alt="{{ role|title }}" class="rounded shadow-sm border" width="180" height="180" onerror="this.onerror=null;this.src='{{ STATIC_URL }}images/registrar.jpg';">
            {% endif %}
          </div>
        </div>
      </div>

      <div class="text-center mt-4">
        <button type="submit" class="btn btn-primary px-4 me-2">
          <i class="bi bi-save2 me-1"></i> Save Changes
        </button>
        <a href="{% url 'staff_profile_list' %}" class="btn btn-outline-secondary px-4">
          <i class="bi bi-x-circle me-1"></i> Cancel
        </a>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('input, select, textarea').forEach(el => {
      if (!el.classList.contains('form-control') && !el.classList.contains('form-select')) {
        if (el.tagName === 'SELECT') el.classList.add('form-select');
        else el.classList.add('form-control');
      }
    });
  });
</script>
{% endblock %}
