{% extends "base.html" %}
{% block content %}
<div class="admin-wrapper">
  <h2 class="admin-title">Manage Programs</h2>

  <!-- === ADD PROGRAM FORM === -->
  <div class="admin-card">
    <h3 class="card-title"><i class="fa fa-book"></i> Add New Program</h3>

    <form method="post" class="styled-form">
      {% csrf_token %}
      <div class="form-row">
        <div class="form-group">
          <label>Program Name</label>
          {{ form.name }}
        </div>
        <div class="form-group">
          <label>Department</label>
          {{ form.department }}
        </div>
      </div>
      <button type="submit" name="create_program" class="btn-primary">+ Add Program</button>
    </form>
  </div>

  <!-- === EXISTING PROGRAMS TABLE === -->
  <div class="admin-card">
    <h3 class="card-title"><i class="fa fa-list"></i> Existing Programs</h3>

    {% if programs %}
    <div class="table-container">
      <table class="pretty-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Program Name</th>
            <th>Department</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for prog in programs %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ prog.name }}</td>
            <td>{{ prog.department.department }}</td>
            <td class="text-center">
              <!-- Edit -->
              <button class="btn-action edit" data-bs-toggle="modal" data-bs-target="#editModal{{ prog.id }}">
                <i class="fa fa-edit"></i>
              </button>

              <!-- Delete -->
              <form method="post" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="prog_id" value="{{ prog.id }}">
                <button type="submit" name="delete_program" class="btn-action delete" onclick="return confirm('Delete this program?');">
                  <i class="fa fa-trash"></i>
                </button>
              </form>
            </td>
          </tr>

          <!-- === EDIT MODAL === -->
          <div class="modal fade" id="editModal{{ prog.id }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                  <h5 class="modal-title"><i class="fa fa-edit"></i> Edit Program</h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form method="post">
                  {% csrf_token %}
                  <div class="modal-body">
                    <input type="hidden" name="prog_id" value="{{ prog.id }}">
                    <div class="form-group mb-3">
                      <label>Program Name</label>
                      <input type="text" name="name" value="{{ prog.name }}" class="form-control" required>
                    </div>
                    <div class="form-group mb-3">
                      <label>Department</label>
                      <select name="department" class="form-control" required>
                        {% for dep in form.fields.department.queryset %}
                          <option value="{{ dep.id }}" {% if dep.id == prog.department.id %}selected{% endif %}>
                            {{ dep.department }}
                          </option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="submit" name="update_program" class="btn btn-success">Save Changes</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="empty-state">No programs have been added yet.</p>
    {% endif %}
  </div>
</div>

<!-- === STYLES === -->
<style>
:root {
  --bg: #f7f8fa;
  --card: #fff;
  --accent: #2563eb;
  --accent-dark: #1d4ed8;
  --text: #1e293b;
  --muted: #6b7280;
  --border: #e2e8f0;
  --radius: 14px;
  --shadow: 0 8px 25px rgba(0,0,0,0.05);
}

body { background: var(--bg); }

.admin-wrapper {
  max-width: 1000px;
  margin: 50px auto;
  padding: 10px;
  font-family: "Poppins", "Inter", sans-serif;
  color: var(--text);
}

.admin-title {
  text-align: center;
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 35px;
}

.admin-card {
  background: var(--card);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 30px;
  margin-bottom: 30px;
}

.card-title {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 20px;
  border-left: 4px solid var(--accent);
  padding-left: 10px;
}

/* === FORM === */
.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 6px;
}

.form-group input,
.form-group select {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: #fff;
  transition: 0.2s;
}

.form-group input:focus,
.form-group select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
}

/* === BUTTON === */
.btn-primary {
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 10px 20px;
  font-weight: 600;
  transition: 0.2s;
}

.btn-primary:hover { background: var(--accent-dark); }

/* === TABLE === */
.table-container {
  overflow-x: auto;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
}

.pretty-table {
  width: 100%;
  border-collapse: collapse;
  border-radius: var(--radius);
  overflow: hidden;
}

.pretty-table th {
  background: #f1f5f9;
  color: var(--text);
  text-align: left;
  font-weight: 600;
  padding: 14px 16px;
  border-bottom: 2px solid var(--border);
}

.pretty-table td {
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
  vertical-align: middle;
}

.pretty-table tr:last-child td {
  border-bottom: none;
}

.pretty-table tr:hover {
  background: #f9fafb;
  transition: 0.2s ease;
}

/* === ACTION BUTTONS === */
.btn-action {
  border: none;
  background: none;
  cursor: pointer;
  font-size: 1rem;
  margin: 0 4px;
  transition: 0.2s;
}

.btn-action.edit i { color: var(--accent); }
.btn-action.delete i { color: #dc2626; }

.btn-action:hover i {
  transform: scale(1.15);
}

/* === EMPTY STATE === */
.empty-state {
  text-align: center;
  color: var(--muted);
  font-style: italic;
  padding: 25px 0;
}

/* === MODAL === */
.modal-header {
  background: var(--accent);
  color: white;
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
}
.styled-form button[type="submit"] {
  margin-top: 15px; /* adjust to 20px if you want even more space */
}
</style>
{% endblock %}
